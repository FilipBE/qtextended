<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>QDrmContentPlugin Class Reference</title>
  <link href="classic.css" rel="stylesheet" type="text/css" />
</head>
<body>
<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
<td align="left" valign="top" width="32"><img src="images/qtlogo.png" align="left" border="0" /></td>
<td width="1">&nbsp;&nbsp;</td><td class="postheader" valign="center"><a href="index.html"><font color="#004faf">Home</font></a>&nbsp;&middot; <a href="namespaces.html"><font color="#004faf">All&nbsp;Namespaces</font></a>&nbsp;&middot; <a href="classes.html"><font color="#004faf">All&nbsp;Classes</font></a>&nbsp;&middot; <a href="groups.html"><font color="#004faf">Grouped Classes</font></a>&nbsp;&middot; <a href="modules-index.html"><font color="#004faf">Modules</font></a>&nbsp;&middot; <a href="functions.html"><font color="#004faf">Functions</font></a></td>
<td align="right" valign="center"><img src="images/codeless.png" border="0" alt="codeless banner"></td></tr></table><h1 class="title">QDrmContentPlugin Class Reference<br /><span class="small-subtitle">[<a href="qtbasemodule.html">QtBaseModule</a>]</span>
</h1>
<p>The QDrmContentPlugin class is the primary interface between DRM agents and the Qt Extended document system. <a href="#details">More...</a></p>
<pre>    #include &lt;QDrmContentPlugin&gt;</pre><p>Inherits <a href="qobject.html">QObject</a> and <a href="qabstractfileenginehandler.html">QAbstractFileEngineHandler</a>.</p>
<ul>
<li><a href="qdrmcontentplugin-members.html">List of all members, including inherited members</a></li>
</ul>
<a name="public-functions"></a>
<h3>Public Functions</h3>
<ul>
<li><div class="fn"/><b><a href="qdrmcontentplugin.html#QDrmContentPlugin">QDrmContentPlugin</a></b> ( QObject * <i>parent</i> )</li>
<li><div class="fn"/>virtual <b><a href="qdrmcontentplugin.html#dtor.QDrmContentPlugin">~QDrmContentPlugin</a></b> ()</li>
<li><div class="fn"/>virtual bool <b><a href="qdrmcontentplugin.html#activate">activate</a></b> ( const QContent &amp; <i>content</i>, QDrmRights::Permission <i>permission</i>, QWidget * <i>focus</i> ) = 0</li>
<li><div class="fn"/>virtual void <b><a href="qdrmcontentplugin.html#activate-2">activate</a></b> ( const QContent &amp; <i>content</i>, QWidget * <i>focus</i> ) = 0</li>
<li><div class="fn"/>virtual bool <b><a href="qdrmcontentplugin.html#canActivate">canActivate</a></b> ( const QString &amp; <i>fileName</i> ) = 0</li>
<li><div class="fn"/>virtual QIODevice * <b><a href="qdrmcontentplugin.html#createDecoder">createDecoder</a></b> ( const QString &amp; <i>fileName</i>, QDrmRights::Permission <i>permission</i> )</li>
<li><div class="fn"/>virtual bool <b><a href="qdrmcontentplugin.html#deleteFile">deleteFile</a></b> ( const QString &amp; <i>fileName</i> ) = 0</li>
<li><div class="fn"/>virtual QDrmRights <b><a href="qdrmcontentplugin.html#getRights">getRights</a></b> ( const QString &amp; <i>fileName</i>, QDrmRights::Permission <i>permission</i> ) = 0</li>
<li><div class="fn"/>virtual QList&lt;QPair&lt;QString, QString&gt; &gt; <b><a href="qdrmcontentplugin.html#httpHeaders">httpHeaders</a></b> () const</li>
<li><div class="fn"/>virtual bool <b><a href="qdrmcontentplugin.html#installContent">installContent</a></b> ( const QString &amp; <i>fileName</i>, QContent * <i>content</i> ) = 0</li>
<li><div class="fn"/>virtual bool <b><a href="qdrmcontentplugin.html#isProtected">isProtected</a></b> ( const QString &amp; <i>fileName</i> ) const = 0</li>
<li><div class="fn"/>virtual QStringList <b><a href="qdrmcontentplugin.html#keys">keys</a></b> () const = 0</li>
<li><div class="fn"/>QDrmContentLicense * <b><a href="qdrmcontentplugin.html#license">license</a></b> ( const QString &amp; <i>fileName</i> ) const</li>
<li><div class="fn"/>virtual QDrmRights::Permissions <b><a href="qdrmcontentplugin.html#permissions">permissions</a></b> ( const QString &amp; <i>fileName</i> ) = 0</li>
<li><div class="fn"/>virtual void <b><a href="qdrmcontentplugin.html#reactivate">reactivate</a></b> ( const QContent &amp; <i>content</i>, QDrmRights::Permission <i>permission</i>, QWidget * <i>focus</i> ) = 0</li>
<li><div class="fn"/>virtual QDrmContentLicense * <b><a href="qdrmcontentplugin.html#requestContentLicense">requestContentLicense</a></b> ( const QContent &amp; <i>content</i>, QDrmRights::Permission <i>permission</i>, QDrmContent::LicenseOptions <i>options</i> )</li>
<li><div class="fn"/>virtual QPixmap <b><a href="qdrmcontentplugin.html#thumbnail">thumbnail</a></b> ( const QString &amp; <i>fileName</i>, const QSize &amp; <i>size</i>, Qt::AspectRatioMode <i>mode</i> = Qt::KeepAspectRatio )</li>
<li><div class="fn"/>virtual QStringList <b><a href="qdrmcontentplugin.html#types">types</a></b> () const = 0</li>
<li><div class="fn"/>virtual qint64 <b><a href="qdrmcontentplugin.html#unencryptedSize">unencryptedSize</a></b> ( const QString &amp; <i>fileName</i> ) = 0</li>
<li><div class="fn"/>virtual bool <b><a href="qdrmcontentplugin.html#updateContent">updateContent</a></b> ( QContent * <i>content</i> )</li>
</ul>
<ul>
<li><div class="fn"/>29 public functions inherited from <a href="qobject.html#public-functions">QObject</a></li>
<li><div class="fn"/>1 public function inherited from <a href="qabstractfileenginehandler.html#public-functions">QAbstractFileEngineHandler</a></li>
</ul>
<a name="static-public-members"></a>
<h3>Static Public Members</h3>
<ul>
<li><div class="fn"/>void <b><a href="qdrmcontentplugin.html#initialize">initialize</a></b> ()</li>
</ul>
<ul>
<li><div class="fn"/>4 static public members inherited from <a href="qobject.html#static-public-members">QObject</a></li>
</ul>
<a name="protected-slots"></a>
<h3>Protected Slots</h3>
<ul>
<li><div class="fn"/>void <b><a href="qdrmcontentplugin.html#registerLicense">registerLicense</a></b> ( QDrmContentLicense * <i>license</i> )</li>
</ul>
<h3>Additional Inherited Members</h3>
<ul>
<li><div class="fn"/>1 property inherited from <a href="qobject.html#properties">QObject</a></li>
<li><div class="fn"/>1 public slot inherited from <a href="qobject.html#public-slots">QObject</a></li>
<li><div class="fn"/>1 signal inherited from <a href="qobject.html#signals">QObject</a></li>
<li><div class="fn"/>1 public type inherited from <a href="qobject.html#public-variables">QObject</a></li>
<li><div class="fn"/>7 protected functions inherited from <a href="qobject.html#protected-functions">QObject</a></li>
<li><div class="fn"/>2 protected variables inherited from <a href="qobject.html#protected-variables">QObject</a></li>
</ul>
<a name="details"></a>
<hr />
<h2>Detailed Description</h2>
<p>The QDrmContentPlugin class is the primary interface between DRM agents and the Qt Extended document system.</p>
<p>QDrmContentPlugin allows the document system to present the license state and meta-info of DRM protected files, provide activation options and provide metered access to the plain-text content of those files.</p>
<a name="drm-content-recognition-and-installation"></a>
<h3>DRM Content Recognition and Installation</h3>
<p>When the document system discovers new content on a device it will attempt to determine if it is DRM protected by calling <a href="qdrmcontentplugin.html#installContent">installContent</a>() for each DRM content plugin installed. If a plugin recognizes the content as DRM protected it should populate the passed <a href="qcontent.html">QContent</a> with meta-data from the files and return true which will mark the content as being DRM protected.</p>
<p>Once a <a href="qcontent.html">QContent</a> has been identified as being DRM protected the document system will identify the plugin by looking up the file extension in the list returned by <a href="qdrmcontentplugin.html#keys">keys</a>(). If a file passed to <a href="qdrmcontentplugin.html#installContent">installContent</a>() is DRM protected but does not have a correct extension it should be renamed by the plugin when it is installed. Likewise if a DRM format has separate transport and storage formats the plugin should convert from the transport format to the storage format when it is installed.</p>
<a name="drm-file-access"></a>
<h3>DRM File Access</h3>
<p>The document system requires applications to request a license through <a href="qdrmcontent.html">QDrmContent</a> before they can access the plain-text content of a DRM protected file. When a license is requested the document system first checks the current permissions of the file, if permission the license is requested for is not valid the document system will attempt to acquire rights for the file by calling <a href="qdrmcontentplugin.html#activate">activate</a>(). If the file permissions were already valid or the activation was successful the document system will then attempt to acquire an instance of <a href="qdrmcontentlicense.html">QDrmContentLicense</a> by calling <a href="qdrmcontentplugin.html#requestContentLicense">requestContentLicense</a>() which will be used to update the files license constraints. Content licenses can be registered by calling <a href="qdrmcontentplugin.html#registerLicense">registerLicense</a>() and once a license has been registered it can be retrieved using <a href="qdrmcontentplugin.html#license">license</a>(), deleted licenses are automatically unregistered. QDrmContentPlugin inherits from <a href="qabstractfileengine.html">QAbstractFileEngine</a> and its implementation of <a href="qabstractfileenginehandler.html#create">create</a>() constructs a file engine which will allow application to open a DRM protected file in read-only mode if a content license for that file has been registered with the plugin, the file will be opened using a <a href="qiodevice.html">QIODevice</a> created by <a href="qdrmcontentplugin.html#createDecoder">createDecoder</a>() with the permission the license was requested for. When a license is released the document system will call <a href="qdrmcontentplugin.html#reactivate">reactivate</a>() irregardless of the current permissions of the file, if rights have expired or will expire in the near future a plugin may prompt the user to acquire new rights.</p>
<p>See also <a href="qdrmcontent.html">QDrmContent</a>.</p>
<hr />
<h2>Member Function Documentation</h2>
<h3 class="fn"><a name="QDrmContentPlugin"></a>QDrmContentPlugin::QDrmContentPlugin ( <a href="qobject.html">QObject</a> * <i>parent</i> )</h3>
<p>Constructs a new drm content plug-in with the given <i>parent</i>.</p>
<h3 class="fn"><a name="dtor.QDrmContentPlugin"></a>QDrmContentPlugin::~QDrmContentPlugin ()&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Destroys a <a href="qdrmcontentplugin.html">QDrmContentPlugin</a> object.</p>
<h3 class="fn"><a name="activate"></a>bool QDrmContentPlugin::activate ( const <a href="qcontent.html">QContent</a> &amp; <i>content</i>, <a href="qdrmrights.html#Permission-enum">QDrmRights::Permission</a> <i>permission</i>, <a href="qwidget.html">QWidget</a> * <i>focus</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Checks if there are valid rights to render the DRM protected content <i>content</i> with the given <i>permission</i>. If there are currently no valid rights an attempt to acquire new rights is initiated, which may be done by downloading the rights directly or by prompting the user to visit a web site.</p>
<p>If the content had valid rights when this method was called or new rights could be acquired directly this will return true. Otherwise if the rights are invalid and new rights can not be obtained or the rights acquisition process requires external action such as visiting a web page this will return false.</p>
<p>Any dialogs displayed will be parented off the given <i>focus</i> widget.</p>
<p>This method will block until the rights activation process has been completed which may take significant time.</p>
<h3 class="fn"><a name="activate-2"></a>void QDrmContentPlugin::activate ( const <a href="qcontent.html">QContent</a> &amp; <i>content</i>, <a href="qwidget.html">QWidget</a> * <i>focus</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>This is an overloaded member function, provided for convenience.</p>
<p>Initiates an attempt to acquire rights for the given DRM protected <i>content</i> in response to the user selecting an activation menu option or similar action.</p>
<p>Any dialogs displayed will be parented off the given <i>focus</i> widget.</p>
<p>See also <a href="qdrmcontentplugin.html#canActivate">canActivate</a>().</p>
<h3 class="fn"><a name="canActivate"></a>bool QDrmContentPlugin::canActivate ( const <a href="qstring.html">QString</a> &amp; <i>fileName</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Indicates whether the user should be given a menu option to activate the DRM protected content with the file name <i>fileName</i>.</p>
<p>Returns true if the content with the file name <i>fileName</i> can be activated.</p>
<p>See also <a href="qdrmcontentplugin.html#activate">activate</a>().</p>
<h3 class="fn"><a name="createDecoder"></a><a href="qiodevice.html">QIODevice</a> * QDrmContentPlugin::createDecoder ( const <a href="qstring.html">QString</a> &amp; <i>fileName</i>, <a href="qdrmrights.html#Permission-enum">QDrmRights::Permission</a> <i>permission</i> )&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Returns a new <a href="qiodevice.html">QIODevice</a> which provides access to the decrypted content of the DRM file with the file name <i>fileName</i>. If the file cannot be opened for rendering with the given <i>permission</i> a null pointer will be returned instead.</p>
<p>The returned <a href="qiodevice.html">QIODevice</a> will not update any license constraints. In order to update the constraints with the correct usage a content license should be requested using <a href="qdrmcontentplugin.html#requestContentLicense">requestContentLicense</a>() and explicitly updated with the usage.</p>
<p>See also <a href="qdrmcontentplugin.html#requestContentLicense">requestContentLicense</a>().</p>
<h3 class="fn"><a name="deleteFile"></a>bool QDrmContentPlugin::deleteFile ( const <a href="qstring.html">QString</a> &amp; <i>fileName</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Deletes the DRM protected file with the file name <i>fileName</i>.</p>
<p>Returns true if the file was sucessfully deleted.</p>
<h3 class="fn"><a name="getRights"></a><a href="qdrmrights.html">QDrmRights</a> QDrmContentPlugin::getRights ( const <a href="qstring.html">QString</a> &amp; <i>fileName</i>, <a href="qdrmrights.html#Permission-enum">QDrmRights::Permission</a> <i>permission</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Returns the rights associated with the drm protected file with the file name <i>fileName</i> for the given <i>permission</i>.</p>
<h3 class="fn"><a name="httpHeaders"></a><a href="qlist.html">QList</a>&lt;<a href="qpair.html">QPair</a>&lt;<a href="qstring.html">QString</a>, <a href="qstring.html">QString</a>&gt; &gt; QDrmContentPlugin::httpHeaders () const&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Returns a list of HTTP header key/value pairs DRM enabled web applications should advertise to indicate support for the DRM content handled by the plugin.</p>
<h3 class="fn"><a name="initialize"></a>void QDrmContentPlugin::initialize ()&nbsp;&nbsp;<tt> [static]</tt></h3>
<p>Ensures all DRM plugins have been instantiated. This should be called before scanning directories for content to ensure the file engines for drm content are loaded and content contained within multipart files can be found.</p>
<h3 class="fn"><a name="installContent"></a>bool QDrmContentPlugin::installContent ( const <a href="qstring.html">QString</a> &amp; <i>fileName</i>, <a href="qcontent.html">QContent</a> * <i>content</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Populates a newly created <a href="qcontent.html">QContent</a> <i>content</i> with meta-data from the file with the file name <i>fileName</i>.</p>
<p>This at a minimum sets the name and type of the <a href="qcontent.html">QContent</a>, but may also set other attributes such as an icon or any number of property values. In some cases the file may be converted to an localized format and renamed, one such instance is OMA DRM message (application/vnd.oma.drm.message) files which are converted to the content format (application/vnd.oma.drm.content) when installed.</p>
<p>Returns true if the file is a valid DRM file.</p>
<p>See also <a href="qcontent.html">QContent</a>.</p>
<h3 class="fn"><a name="isProtected"></a>bool QDrmContentPlugin::isProtected ( const <a href="qstring.html">QString</a> &amp; <i>fileName</i> ) const&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Returns true if the file with the file name <i>fileName</i> is DRM protected.</p>
<h3 class="fn"><a name="keys"></a><a href="qstringlist.html">QStringList</a> QDrmContentPlugin::keys () const&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Returns the file extensions of all DRM file formats supported. This is used to identify the DRM plugin that should handle a file type.</p>
<h3 class="fn"><a name="license"></a><a href="qdrmcontentlicense.html">QDrmContentLicense</a> * QDrmContentPlugin::license ( const <a href="qstring.html">QString</a> &amp; <i>fileName</i> ) const</h3>
<p>Checks if a license for the content with the file name <i>fileName</i> is registered with the plugin. A pointer to a registered license is returned if found otherwise a null pointer is returned.</p>
<p>See also <a href="qdrmcontentplugin.html#registerLicense">registerLicense</a>() and <a href="qdrmcontentplugin.html#requestContentLicense">requestContentLicense</a>().</p>
<h3 class="fn"><a name="permissions"></a><a href="qdrmrights.html#Permission-enum">QDrmRights::Permissions</a> QDrmContentPlugin::permissions ( const <a href="qstring.html">QString</a> &amp; <i>fileName</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Returns the current valid permissions of the DRM protected content with the file name <i>fileName</i>.</p>
<h3 class="fn"><a name="reactivate"></a>void QDrmContentPlugin::reactivate ( const <a href="qcontent.html">QContent</a> &amp; <i>content</i>, <a href="qdrmrights.html#Permission-enum">QDrmRights::Permission</a> <i>permission</i>, <a href="qwidget.html">QWidget</a> * <i>focus</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Checks if the rights to render <i>content</i> with the given <i>permission</i> have expired or will expire in the near future. If either condition is true and there is a valid activation mechanism for the content the user is informed and prompted to reactivate the content.</p>
<p>Any dialogs displayed will be parented off the given <i>focus</i> widget.</p>
<h3 class="fn"><a name="registerLicense"></a>void QDrmContentPlugin::registerLicense ( <a href="qdrmcontentlicense.html">QDrmContentLicense</a> * <i>license</i> )&nbsp;&nbsp;<tt> [protected slot]</tt></h3>
<p>Registers a new content <i>license</i> with the plugin.</p>
<p>See also <a href="qdrmcontentplugin.html#license">license</a>() and <a href="qdrmcontentplugin.html#requestContentLicense">requestContentLicense</a>().</p>
<h3 class="fn"><a name="requestContentLicense"></a><a href="qdrmcontentlicense.html">QDrmContentLicense</a> * QDrmContentPlugin::requestContentLicense ( const <a href="qcontent.html">QContent</a> &amp; <i>content</i>, <a href="qdrmrights.html#Permission-enum">QDrmRights::Permission</a> <i>permission</i>, <a href="qdrmcontent.html#LicenseOption-enum">QDrmContent::LicenseOptions</a> <i>options</i> )&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Requests a content license for rendering <i>content</i> with the given <i>permission</i>. If the content has valid and current rights a pointer to a new content license is returned otherwise a null pointer is returned. The initial state of the content license is determined by the license <i>options</i>.</p>
<p>Implementing classes should register new content licenses with the plugin using <a href="qdrmcontentplugin.html#registerLicense">registerLicense</a>(), the content licenses are unregistered automatically when destroyed. Once a license has been granted and registered with the plugin access to the unencrypted content of the DRM protected file will become available through the Qt file API for the duration of the license's lifetime.</p>
<h3 class="fn"><a name="thumbnail"></a><a href="qpixmap.html">QPixmap</a> QDrmContentPlugin::thumbnail ( const <a href="qstring.html">QString</a> &amp; <i>fileName</i>, const <a href="qsize.html">QSize</a> &amp; <i>size</i>, <a href="qt.html#AspectRatioMode-enum">Qt::AspectRatioMode</a> <i>mode</i> = Qt::KeepAspectRatio )&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Creates a preview thumbnail image of the content with the file name <i>fileName</i> scaled to the given <i>size</i>. Aspect ratio is maintained according to <i>mode</i>.</p>
<h3 class="fn"><a name="types"></a><a href="qstringlist.html">QStringList</a> QDrmContentPlugin::types () const&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Returns the mime types of all DRM file formats supported by the plugin. These types are set in the accept headers of DRM enabled web applications.</p>
<h3 class="fn"><a name="unencryptedSize"></a><a href="qtglobal.html#qint64-typedef">qint64</a> QDrmContentPlugin::unencryptedSize ( const <a href="qstring.html">QString</a> &amp; <i>fileName</i> )&nbsp;&nbsp;<tt> [pure virtual]</tt></h3>
<p>Returns the size in bytes of the plaintext content of a DRM protected file with the file name <i>fileName</i>.</p>
<h3 class="fn"><a name="updateContent"></a>bool QDrmContentPlugin::updateContent ( <a href="qcontent.html">QContent</a> * <i>content</i> )&nbsp;&nbsp;<tt> [virtual]</tt></h3>
<p>Refreshes the content data of <i>content</i> following a change to the file it references.</p>
<p>Returns true if the content data was out of date, false otherwise.</p>
<p /><address><hr /><div align="center">
<table width="100%" cellspacing="0" border="0"><tr class="address">
<td align="left">Copyright &copy; 2009 Trolltech</td>
<td align="center"><a href="trademarks.html">Trademarks</a></td>
<td align="right"><div align="right">Qt Extended 4.4.3</div></td>
</tr></table></div></address></body>
</html>
